"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,a,e){var o,n=[],i=[],r=new a.source.Vector({features:i}),s=new a.layer.Vector({source:r});a.Overlay.prototype.show=function(){this.setPosition(this.get("coords"))},a.Overlay.prototype.hide=function(){this.set("coords",this.getPosition()),this.setPosition(void 0)},a.Overlay.prototype.toggle=function(){void 0!==this.getPosition()?this.hide():this.show()};var l=function(){var t=o.getView();t.setCenter([683109.119003381,5645615.72126983]),t.setZoom(12)},p=function(){var e=r.getFeatures(),n=[],i=o.getView();if(t.each(e,function(){var t=this.getGeometry().getCoordinates();void 0!==t&&n.push(t)}),n.length>0){var s=a.extent.boundingExtent(n);i.fit(s,o.getSize())}},d=function(t){var e=new a.Feature({id:t.attr("data-id"),geometry:new a.geom.Point([t.attr("data-lon"),t.attr("data-lat")]),name:t.attr("data-title"),population:4e3,rainfall:500});return e.setStyle(new a.style.Style({image:new a.style.Icon({anchor:[.5,.5],anchorOrigin:"bottom-left",anchorXUnits:"fraction",anchorYUnits:"pixels",opacity:1,scale:1.1,src:"https://map.jena.de/StadtplanOpenLayers/img/marker.png"}),text:new a.style.Text({offsetY:-23,font:"11px helvetica,sans-serif",text:t.attr("data-poi-counter").substr(0,3),scale:1.1,fill:new a.style.Fill({color:"#000"}),stroke:new a.style.Stroke({color:"transparent",width:2})})})),e},c=function(){var a=[];r.clear(),t(".poiData").each(function(){""!==t(this).attr("data-lon")&&""!==t(this).attr("data-lat")&&"true"===t(this).attr("data-visible")&&a.push(d(t(this)))}),r.addFeatures(a),p(),0===a.length&&l()},u=function(t){o.getOverlayById("overlayPopup"+t).hide()},h=function(){var e="http://maps.google.com";navigator.userAgent.search("Mac OS")>0&&(e="http://maps.apple.com"),t(".poiPopup").each(function(){var o=t(this),i=t("#poiData"+o.attr("data-id"));if(_typeof(o.attr("id"))&&o.prop("id","poiPopup"+o.attr("data-id")),"true"===o.attr("data-ext-map-link")&&o.append('<a class="popupExtMapLink" href="'+e+"?q="+i.attr("data-str-hnr")+', Jena, Deutschland" title="'+o.attr("data-ext-map-title")+'">'+o.attr("data-ext-map-title")+"</a>"),""!==i.attr("data-lon")&&""!==i.attr("data-lat")){var r=new a.Overlay({id:"overlayPopup"+t(this).attr("data-id"),element:document.getElementById("poiPopup"+t(this).attr("data-id")),positioning:"bottom-right",autoPan:!0,autoPanAnimation:{duration:250}});r.set("coords",[i.attr("data-lon"),i.attr("data-lat")]),n.push(r)}else t(this).remove()})},f=function(){t(".poiToggle").each(function(){t(this).on("click",function(){var a=t("#poiData"+t(this).attr("data-id"));"true"===a.attr("data-visible")?(u(a.attr("data-id")),a.attr("data-visible","false")):"false"===a.attr("data-visible")&&a.attr("data-visible","true"),c()})})},y=function(){o=new a.Map({target:"map",logo:!1,layers:[new a.layer.Image({title:"Stadtplan Jena",source:new a.source.ImageWMS({attributions:[new a.Attribution({html:'&copy; <a href="http://www.jena.de">Stadtverwaltung Jena</a>'})],ratio:2,projection:new a.proj.Projection({code:"EPSG:25832",units:"m"}),url:"https://map.jena.de/mapcache",params:{LAYERS:"Stadtplan",FORMAT:"image/png",VERSION:"1.1.1",TRANSPARENT:"",BBOX:[674e3,5636e3,688e3,5652e3]}})})],overlays:n,view:new a.View({center:[683109.119003381,5645615.72126983],projection:new a.proj.Projection({code:"EPSG:25832",units:"m"}),minZoom:12,maxZoom:19,zoom:12,extent:[674e3,5636e3,688e3,5652e3],resolutions:[29.6875,14.84375,7.421875,3.7109375,1.85546875,.927734375,.4638671875]})}),o.on("click",function(t){o.forEachFeatureAtPixel(t.pixel,function(t){var a=t.get("id");o.getOverlayById("overlayPopup"+a).toggle()})}),c(),o.addLayer(s)};!function(a){var e=[];t(".poiData").each(function(){var a=t(this);_typeof(a.attr("id"))&&a.prop("id","poiData"+a.attr("data-id")),(""===a.attr("data-lon")||void 0===a.attr("data-lon")&&""===a.attr("data-lat")||void 0===a.attr("data-lat"))&&(""!==a.attr("data-str-hnr")?e.push({id:a.attr("data-id"),strhnr:a.attr("data-str-hnr")}):a.remove())}),e.length>0?t.ajax({method:"GET",url:"https://www.jena.de/stadtplan-api/web/index.php/str_hnr_split/getByStrHnrBulk.json",data:{q:e}}).done(function(e){t.each(e,function(a,e){if(e.id&&e.lon&&e.lat){var o=t("#poiData"+e.id);o.attr("data-lon",e.lon),o.attr("data-lat",e.lat)}}),"function"==typeof a&&a()}):"function"==typeof a&&a()}(function(){h(),f(),y()})}(jQuery,ol);